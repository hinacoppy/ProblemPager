<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<link rel="stylesheet" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">
<style>
body{
  background: #efe;
}
button{
  font-size: 100%;
  padding: 10px;
}
</style>
<title>exam history</title>
</head>

<body>
<h2>Exam History</h2>

<hr>
<table id='historylist' class="compact cell-border"></table>
<br>
<button id="deletebtn">Delete Checked Data</button>

<!-- scripts -->
<script src="/js/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
<script>
'use strict';

var lskey = "exampager"; //key of localStorage
var exampager = JSON.parse(localStorage.getItem(lskey));

//DataTables定義
const dtSetting = {
    data: exampager, //表示するデータ
    paging: true, // デフォルトでtrueなのでなくてもOK
    pageLength: 10, // 初期表示件数
    lengthMenu: [ [10, 20, 50, -1], [10, 20, 50, "All"] ], // 表示件数メニュー
    order: [[ 0, "desc" ]] , // 初期表示はDateの降順
    language: {},
    columnDefs: [
      { width: "5em", targets: "_all" },
      { className: "dt-body-center", targets: "_all" }], //データ表示は中央寄せ
    columns: [
      { title: "実施日",     data: "date"},
      { title: "番号",       data: "categoryid"},
      { title: "名称",       render: getTitle},
      { title: "回答数",     data: "response"},
      { title: "正答数",     data: "correct"},
      { title: "エラー合計", data: "errorsum"},
      { title: "削除",       render: makeCheckbox,
        width: "1em",
        searchable: false,
        orderable: false,
      }],
  };

//テーブル表示
$('#historylist').DataTable(dtSetting);

$('#deletebtn').on('click', () => {
  $('input[name="check"]:checked').each( (idx, elem) => {
    const [date, categoryid] = $(elem).val().split(":");
    exampager = exampager.filter( (d) => !(d.date == date && d.categoryid == categoryid) );
    //選択行を削除して(選択行以外のデータで)データを再作成
  });

  localStorage.setItem(lskey, JSON.stringify(exampager));
  location.reload(); //ページを再表示(テーブルデータを更新)
});

function makeCheckbox(data, type, row, meta) {
  const val = row.date + ":" + row.categoryid;
  return "<input type='checkbox' name='check' value='" + val + "'>";
}

function getTitle(data, type, row, meta) {
  const titlelist = {
    E11: "バックギャモン検定 2011",
    E12: "バックギャモン検定 2012",
    E13: "バックギャモン検定 2013",
    E14: "バックギャモン検定 2014",
    E15: "バックギャモン検定 2015",
    E16: "バックギャモン検定 2016",
    E17: "バックギャモン検定 2017",
    E18: "バックギャモン検定 2018",
    E19: "バックギャモン検定 2019",
    BQ1: "Problem of Week 1",
    BQ2: "Problem of Week 2",
    BQ3: "Problem of Week 3",
    BQ4: "Problem of Week 4",
    BQ5: "Problem of Week 5",
    BQ6: "Problem of Week 6",
    BQ7: "Problem of Week 7",
    BQ8: "Human vs XG 1",
    BQ9: "Human vs XG 2",
    BQa: "Human vs XG 3",
    BQb: "Human vs XG 4",
    BQc: "Human vs XG 5",
    BQd: "Money Move 1",
    BQe: "Money Move 2",
    BQf: "Money Move 3",
    BQg: "Money Move 4",
    BQh: "Money Move 5",
    BQi: "Money Move 6",
    BQj: "Money Move 7",
    BQk: "Money Move 8",
    BQl: "Money Move 9",
    BQm: "Money Move 10",
    BQn: "Money Move 11",
    BQo: "Money Move 12",
    BQp: "Money Move 13",
    BQq: "Money Move 14",
    BQr: "Money Move 15",
    BQs: "Money Move 16",
    BQt: "Backgammon Strategy 1",
    BQu: "Backgammon Strategy 2",
    BQv: "Backgammon Strategy 3",
    BQw: "Backgammon Strategy 4",
    BP0: "Opening Replies 1",
    BP1: "Opening Replies 2",
    BP2: "Opening Replies 3",
    BP3: "Opening Replies 4",
    BP4: "Opening Replies 5",
    BP5: "Opening Replies 6",
    BP6: "Opening Replies 7",
    BP7: "Opening Replies 8",
    BP8: "Opening Replies 9",
    BP9: "Money Doubles 1",
    BPa: "Money Doubles 2",
    BPb: "Money Doubles 3",
    BPc: "Money Doubles 4",
    BPd: "Money Doubles 5",
    BPe: "Money Doubles 6",
    BPf: "Money Doubles 7",
    BPg: "Money Doubles 8",
    BPh: "Money Doubles 9",
    BPi: "Money Doubles 10",
    BPj: "Money Doubles 11",
    BPk: "Money Doubles 12",
    BPl: "Money Doubles 13",
    BPm: "Money Doubles 14",
    BPn: "Money Doubles 15",
    BPo: "Money Doubles 16",
    BPp: "Money Doubles 17",
    BPq: "Money Doubles 18",
    BPr: "Money Doubles 19",
    BPs: "Money Doubles 20",
    BPt: "Money Doubles 21",
  };
  return titlelist[row.categoryid];
}
</script>
</body>
</html>
